ABC-ICH Mobile Application Specification
========================================

Version: 1.1
Revision Date: 21 February 2018

This is a list of features for the ABC-ICH Mobile application.
The features follow the Behaviour Driven Development (BDD) model and are written in a semi-formal format.

Template
========
<Story> [ A clear and explicit title]								**REQUIRED**
	<Scenario> #1: [The name of the scenario] 						**REQUIRED**
		Given: [the initial context for the scenario]				**REQUIRED - 1 ONLY**
		And: [optional additional context information]				**ZERO OR MORE**
		When: [an event occurs that will trigger this scenario]		**REQUIRED - 1 ONLY**
		Then: [ the outcome that should happen]						**REQUIRED - 1 ONLY**
		And: [ optional additional outcome that should happen]		**ZERO OR MORE**
	</Scenario>    
</Story>

<Note> #1 Data validation popup
	A data validatuon popup is displayed whenever the user leaves any view (except "Patient Start", "Patient End" and "BP Management" views) by selecting the Next button.
	It summarises the data entered in that view and offers 2 possible actions:
	1. Ok - confirms that data entered is correct and allows navigation to proceed
	2. Cancel - Prevents navigation away from the view allowing the user to change the data entered.
</Note>
<Note> #2 
	It is assumed in all the navigation stories listed below that Ok is selected for the Data validation Popup and
	that the view navigation does not happen until all popups have been dismissed.
</Note>
<Note> #3 High water mark view (applies to tabs A and C)
	Users are not allowed to navigate backwards within the views belonging to a particular tab.
	Thus we use the term "high water mark view" to represent how far they have progressed through the views for a particular tab
</Note>

<Story> App launch
	<Scenario> #1: App launch 
		Given: the user is viewing the ABC-ICH launcher icon
		When: they select the launcher icon 
		Then: the "Disclaimer" popup is displayed
	</Scenario>
	<Scenario> #2: User dismisses the Disclaimer popup - no patinent in progress 
		Given: the user is viewing the "Disclaimer" popup
		When: they select the "I Agree" button
		Then: the "Patient Start" view is displayed
		And: the "New Patient" button is displayed
		And: the ABC tabs are not displayed
	</Scenario>
	<Scenario> #3: User dismisses the Disclaimer popup - a patinent is in progress 
		Given: the user is viewing the "Disclaimer" popup
		When: they select the "I Agree" button
		Then: the "Patient Start" view is displayed
		And: the "New Patient" button is displayed
		And: the "Resume Patient" button is displayed
		And: The id of the in-progress patient is displayed
		And: the ABC tabs are not displayed
	</Scenario>   
	<Scenario> #4: User dismisses the Disclaimer popup - User credentials not configured
		Given: the user is viewing the "Disclaimer" popup
		And: the user credentials have not been configured
		When: they select the "I Agree" button
		Then: the "Patient Start" view is displayed
		And: the "New patient" button is disabled
		And: a message is displayed informing the user that the user credentials have not been configured
	</Scenario> 
</Story>

<Story> Configure user credentials
	<Scenario> #1: Display "Configure user credentials" page
		Given: the user is viewing the "Patient Start" view
		And: they are viewing the application menu
		When: they select the "Configure user credentials" menu option
		Then: the "Configure user credentials" page is displayed
	</Scenario>
	<Scenario> #2: Test login button enabled
		Given: the user is viewing the "Configure user credentials" view
		When: both the username and password fields are not empty
		Then: the test login button is enabled
	</Scenario>
	<Scenario> #3: Test login button disabled
		Given: the user is viewing the "Configure user credentials" view
		When: Either the username or password fields are empty
		Then: the test login button is disabled
	</Scenario>
	<Scenario> #4: Test login - success 
		Given: the user is viewing the "Configure user credentials" page
		And: comms is enabled on the device
		And: the server is available
		And: the user has entered a valid username and password
		When: they select the "Test login" button 
		Then: the "Test login - success" popup is displayed
	</Scenario>
	<Scenario> #5: Test login - failure 
		Given: the user is viewing the "Configure user credentials" page
		And: comms is not enabled on the device OR the server is unavailable OR the user has NOT entered a valid username and password
		When: they select the "Test login" button 
		Then: the "Test login - failure" popup is displayed
	</Scenario>
</Story>

<Story> About page
	<Scenario> #1: View about page 
		Given: the user is viewing the "Patient Start" view
		And: they are viewing the application menu
		When: they select the "About" menu option
		Then: the "About" page is displayed
		And: the application version is listed
	</Scenario>
</Story>

<Story> Test Print
    <Scenario> #1: View the Test Print page
        Given: the user is viewing the "Patient Start" view
        And: they are viewing the application menu
        When: they select the "Test Print" menu option
        Then: the "Test Print" page is displayed
        And: a "Test Print" button is visible
        And: a "Back" button is visible
    </Scenario>
    <Scenario> #2: Cancel a test print
        Given: the user is viewing the "Test Print" page
        When: they select the "Back" button
        Then: the "Patient Start" view is displayed
    </Scenario>
    <Scenario> #3: Initiate a test print
        Given: the user is viewing the "Test Print" page
        When: they select the "Test Print" button
        Then: the "Test Print" confirmation popup is displayed
    </Scenario>
    <Scenario> #4: "Test Print" confirmation popup - Cancel Selected
        Given: the user is viewing the "Test Print" confirmation popup
        When: they select the "Cancel" button
        Then: the "Test Print" confirmation popup dismissed
        And: the "Test Print" page is displayed
    </Scenario>
    <Scenario> #5: "Test Print" confirmation popup - OK Selected
        Given: the user is viewing the "Test Print" confirmation popup
        When: they select the "OK" button
        Then: A test document will be created and passed to the Operating System
        And: the Operating System's print dialog will be displayed
        And: Various print options will be available, depending on how the device has been configured
    </Scenario>
    <Scenario> #6: The test print is completed sucessfully or cancelled
        Given: the OS Print dialog will be displayed
        When: the print process is completed successfully or cancelled
        Then: the user is returned to the ABC-ICH app
        And: the "Test Print" page is displayed
    <Scenario>
</Story>

<Story> Patient Start - view navigation
	<Scenario> #1: User selects "New Patient" when no patient in progress 
		Given: the user is viewing the "Patient Start" view
		And: there is no patient in progress
		When: they select the "New Patient" button
		Then: the "Register Patient" view is displayed
		And: the ABC tabs are not displayed
	</Scenario>
	<Scenario> #2: User selects "New Patient" when a patient is in progress 
		Given: the user is viewing the "Patient Start" view
		And: a patient is in progress
		When: they select the "New Patient" button
		Then: the "Confirm new patient" popup is displayed
	</Scenario>
	<Scenario> #3: Confirm new patient popup - Confirm new patient selected 
		Given: the user is viewing the "Confirm new patient" popup
		When: they select the "Confirm" button
		Then: the "Register Patient" view is displayed
		And: the ABC tabs are not displayed
	</Scenario>
	<Scenario> #4: Confirm new patient popup - Cancel new patient selected 
		Given: the user is viewing the "Confirm new patient" popup
		When: they select the "Cancel" button
		Then: the "Patient Start" view is displayed
		And: the ABC tabs are not displayed
	</Scenario>
	<Scenario> #5: User selects "Resume Patient"
		Given: the user is viewing the "Patient Start" view
		When: they select the "Resume Patient" button
		Then: The last selected view should be displayed
		And: the visibility of the ABC tabs should be correct
		And: if the ABC tabs are visible, the selected tab should be correct
        And: the data state when last viewed is maintained
	</Scenario> 
</Story>

<Story> Register Patient - view navigation
	<Note> #5 Matching patient detected
		The server will respond with "matching patient detected" when a patient already exists with identical values for the following criteria:
		- unique id of the hospital
		- patient initials
		- patient age
	</Note>
	<Note> #6 Patient unique id
		Format for patient id is: 
		"HospitalId-initials-Age".
		A numerical postfix is added to duplicates as follows:
		HospitalId-initials-Age_2, HospitalId-initials-Age_3...HospitalId-initials-Age_n.
	</Note>
	<Scenario> #1: No matching patient is detected
		Given: the user has entered valid data on the "Register Patient" view
		And: no matching patient is already registered
		When: they select the "Next" button
		Then: they should see popups in the order listed: 
		      - "Data confirmation" popup
		      - "Enter patient id in notes" popup
		And: the "Patient Details" view is displayed
		And: the ABC tabs are not displayed
	</Scenario>    
	<Scenario> #2: Matching patient is detected 
		Given: the user has entered valid data on the "Register Patient" view
		And: a matching patient is already registered
		When: they select the "Next" button
		Then: they should see popups in the order listed: 
		      - "Data confirmation" popup
			  - "Patient already registered" popup
	</Scenario>    
	<Scenario> #3: Patient already registered popup - Confirm register new patient selected
		Given: the user is viewing the "Patient already registered" popup
		When: they select the "Confirm" button
		Then: they should see the "Enter patient id in notes" popup
		And: the "Patient Details" view is displayed
		And: the ABC tabs are not displayed
	</Scenario>    
	<Scenario> #4: Patient already registered popup - Cancel register new patient selected
		Given: the user is viewing the "Patient already registered" popup
		When: they select the "Cancel" button
		Then: the "Patient Start" view is displayed
		And: the ABC tabs are not displayed
	</Scenario>
</Story>

<Story> Patient Details - view navigation
	<Scenario> #1: View navigation
		Given: the user has entered valid data on the "Patient Details" view
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "GCS entry" view is displayed
		And: the ABC tabs are not displayed
	</Scenario>    
</Story>

<Story> GCS Entry - view navigation
	<Scenario> #1: (GCS >= 9)
		Given: the user has entered valid data on the "GCS entry" view
		And: the GCS value is >= 9
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "Anticoagulant Identification" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is A
	</Scenario>
	<Scenario> #2: (GCS < 9)
		Given: the user has entered valid data on the "GCS entry" view
		And: the GCS value is < 9
		When: they select the "Next" button
		Then: they should see popups in the order listed: 
		      - "Data confirmation" popup
			  - "Stabilise patient" popup
		And: the "Anticoagulant Identification" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is A
	</Scenario> 
</Story>

<Story> Anticoagulant Identification - view navigation
	<Scenario> #1: "Vit K antagonist" selected
		Given: the user has entered valid data on the "Anticoagulant Identification" view
		And: the selected anticoagulant is a Vit K antagonist
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "Calculate Beriplex/Octaplex Dose" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is A
	</Scenario>    
	<Scenario> #2: "Unknown" selected 
		Given: the user has entered valid data on the "Anticoagulant Identification" view
		And: Unknown has been selected
		When: they select the "Next" button
		Then: they should see popups in the order listed: 
		      - "Data confirmation" popup
			  - "Anticoagulant Unknown" popup
		And: the "Calculate Beriplex/Octaplex Dose" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is A
	</Scenario>    
	<Scenario> #3: "Apixaban", "Rivoroxaban", or "Edoxaban" selected.
		Given: the user has entered valid data on the "Anticoagulant Identification" view
		And: the selected anticoagulant is a DOAC
		When: they select the "Next" button
		Then: they should see popups in the order listed: 
		      - "Data confirmation" alert popup
			  - "Send urgent PT, aPPT.." alert popup
			  - "Has DOAC been taken.." confirmation popup.
	</Scenario>    
	<Scenario> #4: "Dabigatran" selected 
		Given: the user has entered valid data on the "Anticoagulant Identification" view
		And: the selected anticoagulant is a DOAC
		When: they select the "Next" button
		Then: they should see popups in the order listed: 
		      - "Data confirmation" popup
		      - "Send urgent PT, aPPT, trhombin time"
		      - "Has the patient taken the DOAC within the last 24 hours?"
	</Scenario>
	<Scenario> #5: "No DOAC has been taken.." selected with "Dabigatran".
		Given: the user has selected "Dabigatran" on the DOAC selection control.
		And: the user is displayed with the "Has DOAC been taken.." confirmation popup.
		When: the user selects the "No" button.
		Then: A "Contact Haematology" popup appears.
		And: the "Reversal Agent details" view is displayed with "Idarcuzimab (Praxabind)" and "None" displayed.
		And: the ABC tabs are visible
		And: the selected tab is A
	</Scenario>
	<Scenario> #6: "DOAC has been taken.." selected with "Dabigatran".
		Given: the user has selected "Dabigatran" on the DOAC selection control.
		And: the user is displayed with the "Has DOAC been taken.." confirmation popup.
		When: the user selects the "Yes" button.
		Then: A screen displaying a "Administer idarcuzimab.." message should appear.
		And: the dosage should be 2x 2.5/50ml as two consecutive infusions over 5 to 10 minutes each or as a bolus injection.
		And: the reversal time card should also be displayed with a date/time entry box.
		And: the ABC tabs are visible
		And: the selected tab is A
	</Scenario>
	<Scenario> #7: "No DOAC has been taken.." selected with "Apixaban", "Rivoroxaban", or "Edoxaban".
		Given: the user has selected either "Apixaban", "Rivoroxaban", or "Edoxaban" on the DOAC selection control.
		And: the user is displayed with the "Has DOAC been taken.." confirmation popup.
		When: the user selects the "No" button.
		Then: A "Contact Haematology" popup appears.
		And: the user is directed to the "Reversal Agent details" with "PCC" selected.
		And: the ABC tabs are visible
		And: the selected tab is A
	</Scenario>
	<Scenario> #8: "DOAC has been taken.." selected with "Apixaban", "Rivoroxaban", or "Edoxaban".
		Given: the user has selected either "Apixaban", "Rivoroxaban", or "Edoxaban" on the DOAC selection control.
		And: the user is displayed with the "Has DOAC been taken.." confirmation popup.
		When: the user selects the "Yes" button.
		Then: the user is directed to "Calculate Beriplex/Octaplex Dose" view
		And: the ABC tabs are visible
		And: the selected tab is A
	</Scenario>
	<Scenario> #9: "None" selected and (GCS >= 9) 
		Given: the user has entered valid data on the "Anticoagulant Identification" view
		And: the selected anticoagulant is None
		And: the GCS value is >= 9
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "BP Management" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is B
	</Scenario>
	<Scenario> #10: "None" selected and (GCS < 9) 
		Given: the user has entered valid data on the "Anticoagulant Identification" view
		And: the selected anticoagulant is None
		And: the GCS value is < 9
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "high water mark view" for tab C is displayed
		And: the ABC tabs are visible
		And: the selected tab is C
	</Scenario>    
</Story>

<Story> Reversal Agent Details - view navigation
	<Scenario> #1: (GCS >= 9)
		Given: the user has entered valid data on the "Reversal Agent details" view
		And: the GCS value is >= 9
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "BP Management" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is B
	</Scenario>    
	<Scenario> #2: (GCS < 9 )
		Given: the user has entered valid data on the "Reversal Agent details" view
		And: the GCS value is < 9
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "high water mark view" for tab C view is displayed
		And: the ABC tabs are visible
		And: the selected tab is C
	</Scenario>
</Story>

<Story> Calculate Beriplex/Octaplex Dose - view navigation
	<Scenario> #1: Beriplex/Octaplex administered at external hospital
		Given: the user has entered valid data on the "Calculate Beriplex/Octaplex Dose" view
		And: Beriplex/Octaplex was administered at an external hospital
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "Reversal Agent details" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is A
	</Scenario>    
	<Scenario> #2: Administer Beriplex/Octaplex without INR result
		Given: the user has entered valid data on the "Calculate Beriplex/Octaplex Dose" view
		And: the user has chosen the option to administer Beriplex/Octaplex without waiting for the INR result
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "Confirm Beriplex/Octaplex Dose" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is A
	</Scenario>    
	<Scenario> #3: (INR < 1.3) and (GCS >= 9) 
		Given: the user has entered valid data on the "Calculate Beriplex/Octaplex Dose" view
		And: the INR value < 1.3
		And: the GCS value is >= 9
		When: they select the "Next" button
		Then: they should see popups in the order listed: 
		      - "Data confirmation" popup
			  - "INR below treatment range" popup
		And: the "BP Management" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is B
	</Scenario>    
	<Scenario> #4: (INR < 1.3) and (GCS < 9) 
		Given: the user has entered valid data on the "Calculate Beriplex/Octaplex Dose" view
		And: the INR value < 1.3
		And: the GCS value is < 9
		When: they select the "Next" button
		Then: they should see popups in the order listed: 
		      - "Data confirmation" popup
			  - "INR below treatment range" popup
		And: the "high water mark view" for tab C is displayed
		And: the ABC tabs are visible
		And: the selected tab is C
	</Scenario>    
	<Scenario> #5: (INR >= 1.3) and Vit K antagonist
		Given: the user has entered valid data on the "Calculate Beriplex/Octaplex Dose" view
		And: the INR value >= 1.3
		And: the selected anticoagulant is a Vit K antagonist
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "Confirm Beriplex/Octaplex Dose" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is A
	</Scenario>    
	<Scenario> #6: (INR >= 1.3) and antagonist Unknown and User has selected "Administer Beriplex/Octaplex"
		Given: the user has entered valid data on the "Calculate Beriplex/Octaplex Dose" view
		And: the INR value >= 1.3
		And: the antagonist is Unknown
		And: the user has selected "Administer Beriplex/Octaplex"
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "Confirm Beriplex/Octaplex Dose" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is A
	</Scenario>    
	<Scenario> #7: (INR >= 1.3) - antagonist Unknown and User has not selected "Administer Beriplex/Octaplex" and (GCS >= 9)
		Given: the user has entered valid data on the "Calculate Beriplex/Octaplex Dose" view
		And: the INR value >= 1.3
		And: the antagonist is Unknown
		And: the user has not selected "Administer Beriplex/Octaplex"
		And: the GCS value is >= 9
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "BP Management" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is B
	</Scenario>    
	<Scenario> #8: (INR >= 1.3) and antagonist Unknown and User has not selected "Administer Beriplex/Octaplex" and (GCS < 9)
		Given: the user has entered valid data on the "Calculate Beriplex/Octaplex Dose" view
		And: the INR value >= 1.3
		And: the antagonist is Unknown
		And: the user has not selected "Administer Beriplex/Octaplex"
		And: the GCS value is < 9
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "high water mark view" for tab C is displayed
		And: the ABC tabs are visible
		And: the selected tab is C
	</Scenario>    
</Story>

<Story> Confirm Beriplex/Octaplex Dose - view navigation
	<Scenario> #1: View navigation
		Given: the user has entered valid data on the "Confirm Beriplex/Octaplex Dose" view
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "Administer Beriplex/Octaplex" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is A
	</Scenario>    
	<Scenario> #2: The user has selected "Apixaban", "Edoxaban", or "Rivaroxaban" in the anticoagulant selection view.
		Given: the user has selected one of the above mentioned DOACs.
		And: they have completed the Calculate Beriplex/Octaplex Dose view
		When: they navigate to the Confirm Beriplex/Octaplex Dose view
		Then: the calculation for the dosage of Beriplex/Octaplex is now 50IU multiplied by their weight in kg.
		And: this value is capped at 5000IU.
	</Scenario>
</Story>

<Story> Administer Beriplex/Octaplex - view navigation
	<Scenario> #1: (GCS >= 9)
		Given: the user has entered valid data on the "Administer Beriplex/Octaplex" view
		And: the GCS value is >= 9
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "BP Management" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is B
	</Scenario>    
	<Scenario> #2: (GCS < 9)
		Given: the user has entered valid data on the "Administer Beriplex/Octaplex" view
		And: the GCS value is < 9
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "high water mark view" for tab C view is displayed
		And: the ABC tabs are visible
		And: the selected tab is C
	</Scenario>   
	<Scenario> #3: The user has selected a "DOAC" in the anticoagulant selection view.
		Given: the user has selected a "DOAC" in the anticoagulant selection view.
		When: they select navigate to the "Adminiser Beriplex/Octaplex" view.
		Then: vitamin k related data collection cards should be hidden.
		And: the ABC tabs are visible
		And: the selected tab is C
	</Scenario>
	<Scenario> #4: The user has not selected a "DOAC" in the anticoagulant selection view.
		Given: the user has selected a "DOAC" in the anticoagulant selection view.
		When: they select navigate to the "Adminiser Beriplex/Octaplex" view.
		Then: vitamin k related data collection cards should be visible.
		And: the ABC tabs are visible
		And: the selected tab is C
	</Scenario>
	<Scenario> #5: The user opens the topup control.
		Given: the user has previously selected to calculate the PCC dose without an INR.
		When: the user has selected the "Administer topup dose" button.
		Then: the topup dose control appears.
	</Scenario>
	<Scenario> #6: The user enters an inr value into the topup control.
		Given: has opened the topup dose control.
		When: the user enters an inr value.
		Then: the calculated topup dose based on the inr value and previous dose appears.
		And: the control allowing the user to override this topup dose value appears.
	</Scenario>
	<Scenario> #7: The user selects not to override the topup dose.
		Given: has opened the topup dose control.
		And: the user has entered an inr value.
		When: selects to not override the topup dose.
		Then: the control updates to show this is selected.
	</Scenario>
	<Scenario> #8: The user selects to override the topup dose.
		Given: has opened the topup dose control.
		And: the user has entered an inr value.
		When: selects to override the topup dose.
		Then: the control updates to show this is selected.
		And: the control allowing the user to enter an override value appears.
	</Scenario>
	<Scenario> #8: The user selects 'confirm' after choosing to not override the topup dose.
		Given: has opened the topup dose control.
		And: the user has entered an inr value.
		And: the user has chosen not to override the calculated topup dose.
		When: the user selects 'confirm'.
		Then: a confirmation popup appears.
	</Scenario>
	<Scenario> #8: The user selects 'confirm' after choosing to override the topup dose.
		Given: has opened the topup dose control.
		And: the user has entered an inr value.
		And: the user has chosen not override the calculated topup dose.
		And: the user has entered an override dosage.
		When: the user selects 'confirm'.
		Then: a confirmation popup appears.
	</Scenario>
	<Scenario> #9: The user selects 'confirm' after failing to enter an inr value.
		Given: has opened the topup dose control.
		And: the user has not entered an inr value
		When: the user selects 'confirm'.
		Then: a invalid information popup appears.
	</Scenario>
	<Scenario> #10: The user selects 'confirm' after failing to choose if they wish to override the topup dose.
		Given: has opened the topup dose control.
		And: the user has not selected whether they should override the topup dose.
		When: the user selects 'confirm'.
		Then: a invalid information popup appears.
	</Scenario>
	<Scenario> #11: The user selects 'confirm' after failing to add an alternative topup dose.
		Given: has opened the topup dose control.
		And: the user has not entered an alternate topup dose after selecting to override the calculated dose.
		When: the user selects 'confirm'.
		Then: a invalid information popup appears.
	</Scenario>
	<Scenario> #12: The user selects 'okay' on the invalidation control.
		Given: the invalid information popup has appeared.
		When: the user selects 'okay'.
		Then: a invalid information popup disappears.
		And: the topup dose control reappears.
	</Scenario>
	<Scenario> #13: The user selects 'cancel' on the confirmation popup control.
		Given: the confirmation popup has appeared.
		When: the user selects 'cancel'.
		Then: a confirmation popup disappears.
		And: the topup dose control reappears.
	</Scenario>
	<Scenario> #14: The user selects 'confirm' on the confirmation popup control.
		Given: the confirmation popup has appeared.
		When: the user selects 'confirm'.
		Then: a confirmation popup disappears.
		And: the topup dose control disappears.
		And: the PCC dose is updated with the topup dose on the page.
	</Scenario>
</Story>

<Story> BP Management - view navigation
	<Note> #7 Treatment target and threshold
		(Onset < 6 hours ago): 	Treatment threshold = 150 mmHg, Treatment target = 140 mmHg
		(Onset >= 6 hours ago): Treatment threshold = 200 mmHg, Treatment target = 180 mmHg
	</Note>	
	<Note> #8 How the view is used
		The patient's SBP reading will be monitored over 1 hour.
		Initial interval is every 15 mins until a reading is above threshold.
		Interval during treatment is every 5 mins.
		If a reading is above threshold then the user is prompted to repeat the reading after 2 mins.
		If this reading is also above threshold then threshold breach is confirmed and treatment begins.
		It's possible during the hour that the threshold breach is confirmed more than once!
	</Note>			
	<Scenario> #1: User selects Next - Target not reached
		Given: the user has entered a series of readings on the "BP Management" view
		And: the threshold breach has been confirmed
		And: the target has not been reached
		When: they select the "Next" button
		Then: the "Refer to Critical Care" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is B
	</Scenario>    
	<Scenario> #2: User selects Next - Target reached (GCS >= 9)
		Given: the user has entered valid data on the "BP Management" view
		And: the target has been reached (or threshold breach not confirmed)
		And: the GCS value is >= 9
		When: they select the "Next" button
		Then: the "high water mark view" for tab C is displayed
		And: the ABC tabs are visible
		And: the selected tab is C
	</Scenario>    
	<Scenario> #3: User selects Next - Target reached (GCS < 9)
		Given: the user has entered valid data on the "BP Management" view
		And: the target has been reached (or threshold breach not confirmed)
		And: the GCS value is < 9
		When: they select the "Next" button
		Then: the "Patient End" view is displayed
		And: the ABC tabs are not displayed
	</Scenario>
	<Scenario> #4: User selects Add entry - show repeat reading popup
		Given: the last reading (if any) was not above threshold
		When: they add an entry where SBP is above threshold
		Then: the repeat reading after 2 minutes popup is displayed
	</Scenario>    
	<Scenario> #5: User selects Add entry - show target reached popup
		Given: the last 2 consecutive readings have been above threshold
		When: they add an entry where SBP is below target
		Then: the target reached popup is displayed
	</Scenario>    
</Story>

<Story> Refer to Critical Care - view navigation
	<Scenario> #1: (GCS >= 9)
		Given: the user has entered valid data on the "Refer to Critical Care" view
		And: the GCS value is >= 9
		When: they select the "Next" button
		Then: the "high water mark view" for tab C is displayed
		And: the ABC tabs are visible
		And: the selected tab is C
	</Scenario>    
	<Scenario> #2: (GCS < 9)
		Given: the user has entered valid data on the "Refer to Critical Care" view
		And: the GCS value is < 9
		When: they select the "Next" button
		Then: the "Patient End" view is displayed
		And: the ABC tabs are not displayed
	</Scenario>    
</Story>

<Story> mRS selection - view navigation
	<Scenario> #1: View navigation
		Given: the user has entered valid data on the "mRS selection" view
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "Neurosurgery referral criteria" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is C
	</Scenario>    
</Story>

<Story> Neurosurgery referral criteria - view navigation
	<Note> #9
		Referral criteria:
			- ichVolume > 30 ml
			- Posterior fossa ICH
			- Obstruction of the third and/or fourth ventricle

		Referral to neurosurgery is not required (Popup title: 'Referral to neurosurgery not required')
		========================================
		GCS >= 9 and none of the Referral criteria are true:

		Referral to nerosurgery is required (Popup title: 'Refer to neurosurgery')
		=================================== 
		(GCS >= 9) AND (any of the Referral criteria are true) AND (mRS < 3)
		OR
		(GCS < 9) AND (mRS < 3)

		Referral to neurosugery should be considered (Popup title: 'Consider referral to neurosurgery')
		============================================
		(GCS >= 9) AND (any of the Referral criteria are true) AND (mRS >= 3)
		OR
		(GCS < 9) AND (mRS >= 3)

	</Note>
	<Scenario> #1: Referral not required
		Given: the user has entered valid data on the "Neurosurgery Referral Criteria" view
		And: referral is not required (see note above)
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "Patient End" view is displayed
		And: the ABC tabs are not displayed
	</Scenario>    
	<Scenario> #2: Referral is required
		Given: the user has entered valid data on the "Neurosurgery Referral Criteria" view
		And: referral is required (see note above)
		When: they select the "Next" button
		Then: they should see popups in the order listed: 
		      - "Data confirmation" popup
			  - "Refer to neurosurgery" popup
		And: the "Neurosurgery Referral Summary" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is C
	</Scenario>    
	<Scenario> #3: Referral should be considered
		Given: the user has entered valid data on the "Neurosurgery Referral Criteria" view
		And: referral should be considered (see note above)
		When: they select the "Next" button
		Then: they should see popups in the order listed: 
		      - "Data confirmation" popup
			  - "Consider referral to neurosurgery" popup
		And: the "Neurosurgery Referral Summary" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is C
	</Scenario>    
</Story>

<Story> Neurosurgery Referral Summary - view navigation
	<Scenario> #1: (GCS >= 9)
		Given: the user has entered valid data on the "Neurosurgery Referral Summary" view
		And: the GCS value is >= 9
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "Patient End" view is displayed
		And: the ABC tabs are not displayed
	</Scenario>    
	<Scenario> #2: (GCS < 9)
		Given: the user has entered valid data on the "Neurosurgery Referral Summary" view
		And: the GCS value is < 9
		When: they select the "Next" button
		Then: they should see the "Data confirmation" popup
		And: the "BP Management" view is displayed
		And: the ABC tabs are visible
		And: the selected tab is B
	</Scenario>     
</Story>

<Story> Patient End - view navigation
	<Scenario> #1: Patient save succeeded
		Given: the user is on the "Patient End" view
		And: comms is available
		When: they select the "Finish" button
		Then: they should see the "Data saved" confirmation popup followed by "Print" popup 
	</Scenario>    
	<Scenario> #2: user chooses not to print
		Given: The print popup is displayed
		When: the user selects "Cancel"
		Then: the "Patient Start" view is displayed
	</Scenario> 
	<Scenario> #3: user chooses to print patient details
		Given: The print popup is displayed
		When: the user selects "OK"
		Then: they are navigated to the selected Print app
		And: a print preview is diaplayed
	</Scenario> 
	<Scenario> #4: User selects send in the Print app
		Given: the user is viewing the print preview in the print app
		When: the user selects send
		Then: the user is returned to the ABC-ICH app		
		And: all of the patient data is cleared
		And: the "Patient End" view is displayed behind a progress indicator
		And: the "Patient Start" view is displayed when the progress indicator disappears
	</Scenario>	   
	<Scenario> #5: User cancels printing in the Print app
		Given: the user is viewing the print preview in the print app
		When: the user selects the hardware back key
		Then: the user is returned to the ABC-ICH app		
		And: all of the patient data is cleared
		And: the "Patient Start" view is displayed
	</Scenario>	   
	<Scenario> #6: Patient save fails
		Given: the user is on the "Patient End" view
		And: comms is not available
		When: they select the "Finish" button
		Then: they should see the "Patient save failed" popup
		And: the "Patient end" view is still displayed
	</Scenario>    
</Story>

<Story> View Navigation via Tab selection
	<Note> #10
		Default views for each tab are as follows:
		- Tab A: Anticoagulant Identification view
		- Tab B: BP Management view
		- Tab C: mRS selection view
	</Note>
	<Scenario> #1: Default view when Tab A selected
		Given: the tabs are being displayed
		And: the user has not navigated away from the default view for tab A using a view button
		And tab A is not selected
		When: the user selects tab A
		Then: the default view for tab A should be displayed
	</Scenario>     
	<Scenario> #2: Non default view when Tab A selected
		Given: the tabs are being displayed
		And: the user has navigated away from the default view for tab A using a view button
		And tab A is not selected
		When: the user selects tab A
		Then: the High water mark view for tab A should be displayed
	</Scenario>     
	<Scenario> #3: Default view when Tab C selected
		Given: the tabs are being displayed
		And: the user has not navigated away from the default view for tab C using a view button
		And tab C is not selected
		When: the user selects tab C
		Then: the default view for tab C should be displayed
	</Scenario>     
	<Scenario> #4: Non default view when Tab C selected
		Given: the tabs are being displayed
		And: the user has navigated away from the default view for tab C using a view button
		And tab C is not selected
		When: the user selects tab C
		Then: the High water mark view for tab C should be displayed
	</Scenario>     
	<Scenario> #5: View displayed when Tab B selected
		Given: the tabs are being displayed
		And tab B is not selected
		When: the user selects tab B
		Then: the default view for tab B should be displayed
	</Scenario>     
</Story>

<Story> View behaviour and layout
	<Note> #11
		Most views are self-describing with the dynamic show/hide behaviour being intuitively obvious.
		Only views where this is not the case are described here.
	</Note>
	<Scenario> #1: Calculate Beriplex/Octaplex view - display of "Reversal agent administered at external hospital?" card
		Given: the user has selected an external hospital on the "Register Patient" view
		When: the "Calculate Beriplex/Octaplex" view is displayed
		Then: the "Reversal agent administered at external hospital?" card is displayed
	</Scenario>   
	<Scenario> #2: Calculate Beriplex/Octaplex view - display of "Anti-coagulant is unknown and INR > 1.2. Prescribe Beriplex/Octaplex anyway?" card
		Given: the user has selected "Unknown" for anticogulant type on the "Anticoagulant Identification" view
		When: the user enters an INR value greater than 1.2
		Then: the "Anti-coagulant is unknown and INR > 1.2. Prescribe Beriplex/Octaplex anyway?" card is displayed
	</Scenario>     
	<Scenario> #3: Reversal Agent Details view - display of "Time reversal agent was administered is known?" card
		Given: the user has selected "Yes" for "Reversal agent administered at external hospital?" on the "Calculate Beriplex/Octaplex" view
		When: the "Reversal Agent Details" view is displayed
		Then: the "Time reversal agent was administered is known?" card is displayed
	</Scenario>     
	<Scenario> #4: Reversal Agent Details view - Reversal agent administered card - hide option "None"
		Given: the user has selected "Yes" for "Reversal agent administered at external hospital?" on the "Calculate Beriplex/Octaplex" view
		When: the "Reversal Agent Details" view is displayed
		Then: the "None" option on the "Reversal agent administered" card is hidden
	</Scenario>   
</Story>

<Story> Calculation of Beriplex/Octaplex dose
	<Note> #12 Calculation details
		The dose is calculated using the weight in Kg and the INR value.
		For the purposes of the calculatuion the weight is rounded to the nearest 10 Kg.
		If the weight is above 100Kg then it is fixed at 100Kg.
		If the weight is below 30Kg then it is fixed at 30Kg.
		The calculated value depends on which range the INR value falls within as follows:
		(1.3 - 3.9): dose = weightInKg x 25
		(4.0 - 6.0): dose = weightInKg x 35
		    (> 6.0): dose = weightInKg x 50
		However, if the anticoagulant type being used is either Apixaban, Edoxaban, or Rivaroxaban, then the calculation is as follows:
				dose = weightInKg x 50
		The maximum dosage is determined by the PCC type which is to be administered.
		Should the PCC type be 'Beriplex' then the maximum value is 5000 IU.
		Should the PCC type be 'Octaplex' then the maximum value is 3000 IU.
	</Note>
	<Scenario> #1: Calculation of Beriplex/Octaplex dose with Inr value
		Given: the user has entered valid data on the "Calculate Beriplex/Octaplex" view
		And: the user has selected "No" to the question "Do you plan to administer Beriplex/Octaplex without waiting for INR?"
		When: they select the "Next" button
		Then: the dose is calculated using the INR value entered
	</Scenario>     
	<Scenario> #2 Calculation of Beriplex/Octaplex dose without Inr value
		Given: the user has entered valid data on the "Calculate Beriplex/Octaplex" view
		And: the user has selected "Yes" to the question "Do you plan to administer Beriplex/Octaplex without waiting for INR?"
		When: they select the "Next" button
		Then: the dose is calculated using a default INR value within the range 1.3 - 3.9 
	</Scenario>     
</Story>

<Story> Dosing tables for Beriplex and Octaplex
	<Note> #1 Dosing tables
		The following two tables are text versions of the tables which a user should see depending on whether they select Beriplex or Octaplex.
		
		Beriplex Dosing Table:
						Dosing 		30 kg 	40 kg 	50 kg 	60 kg 	70 kg 	80 kg 	90 kg 	100+
		INR 1.3-3.9		25 IU/kg 	750 	1000 	1250 	1500 	1750	2000 	2250 	2500
		INR 4.0-6.0		35 IU/kg 	1050 	1400 	1750 	2100 	2450 	2800 	3150 	3500
		INR > 6			50 IU/kg 	1500 	2000 	2500 	3000 	3500 	4000 	4500 	5000

		Octaplex Dosing Table:
		 				Dosing 		30 kg 	40 kg 	50 kg 	60 kg 	70 kg 	80 kg 	90 kg 	100+
		INR 1.3-3.9		25 IU/kg 	750 	1000 	1250 	1500 	1750	2000 	2250 	2500
		INR 4.0-6.0		35 IU/kg 	1050 	1400 	1750 	2100 	2450 	2800 	3000 	3000
		INR > 6			50 IU/kg 	1500 	2000 	2500 	3000 	3000 	3000 	3000 	3000

	</Note>
</Story>

<Story> Data entry range validation
	<Note> #13
		The following data entry fields have ranges which the inputs should adhear to.

		A validation message is displayed when the input contains a value outside the allowed range.

		For a given view, if any validated input contains a value outside the allowed range then the next
		button is disabled.

		The validated fields are:

		Register Patient view - Initials
			2 or 3 characters.

		Register Patient view - Date of birth
			The date of birth field has two layers of verification:
			1) is it a valid date (e.g correct number of days entered for a given month)
			2) is the year within the allowed range: between 1900 and 14 years ago (inclusive)
			The range is not checked until the date is valid.
		
		Calculate Beriplex/Octaplex Dose view - INR value
			between 0.5 and 10 (inclusive)
		
		Calculate Beriplex/Octaplex Dose view - Weight
			between 10 and 300 Kg (inclusive)
			When the weight is entered in stone the validation is carried out against the automatically converted weight
			in Kg value.

		Bp Management view - SBP
			between 10 and 300 (inclusive)

		Bp Management view - DBP
			Not required but if provided value must be between 10 and 300 (inclusive)
		
		Bp Management - GTN rate
			Not required but if provided value must be between 0 and 20 (inclusive)
	 	
	 	Bp management - Labetalol dose
			Not required but if provided value must be between 0 and 100 (inclusive)
		
		Bp management - Pulse
			Not required but if provided value must be between 0 and 300 (inclusive)
		
		Neurosurgery Referral Criteria view - ICH volume
			This value is not visible until all fields are completed in the "ICH volume calculation" card.
			between 0 and 500 (inclusive)
	</Note>
</Story>

<Story> Web client login timeout
	<Scenario> #1 The user logs into the web client and does not select "remember me".
		Given: The user has logged into the web interface.
		And: The user did not select "remember me".
		When: 15 minutes have elapsed.
		Then: The client's login will no longer be authenticated.
		And: Refreshing the page will display the user with the login page.
	</Scenario>

	<Scenario> #2 The user logs into the web client and selects "remember me".
		Given: The user has logged into the web interface.
		And: The user selected "remember me".
		When: 30 minutes have elapsed.
		Then: The client's login will no longer be authenticated.
		And: Refreshing the page will display the user with the login page.
	</Scenario>
</Story>